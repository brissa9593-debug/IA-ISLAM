<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IA ISLAM - Assistant Ã‰ducatif</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background:linear-gradient(to bottom,#fafaf9,#f5f5f4);min-height:100vh;display:flex;flex-direction:column;}
.header{background:rgba(255,255,255,.8);backdrop-filter:blur(20px);border-bottom:1px solid #e7e5e4;position:sticky;top:0;z-index:10;}
.header-content{max-width:56rem;margin:0 auto;padding:1rem;display:flex;align-items:center;justify-content:space-between;}
.header-left{display:flex;align-items:center;gap:.75rem;}
.logo{width:40px;height:40px;object-fit:contain;}
.header-text h1{font-size:1rem;font-weight:600;color:#292524;}
.header-text p{font-size:.75rem;color:#78716c;}
.new-btn{padding:.5rem 1rem;background:white;border:1px solid #e7e5e4;border-radius:12px;cursor:pointer;font-size:.875rem;color:#57534e;font-weight:500;transition:all .2s;}
.new-btn:hover{background:#fafaf9;}
.container{flex:1;overflow-y:auto;padding:1.5rem 1rem;}
.messages{max-width:56rem;margin:0 auto;display:flex;flex-direction:column;gap:1.5rem;}
.school-selector{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:50vh;text-align:center;padding:1rem;}
.school-selector img{width:128px;height:128px;margin-bottom:1.5rem;object-fit:contain;}
.school-selector h2{font-size:1.5rem;font-weight:600;color:#292524;margin-bottom:.75rem;}
.school-selector p{color:#78716c;max-width:28rem;margin-bottom:1.5rem;}
.school-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.75rem;width:100%;max-width:32rem;}
.school-btn{padding:1.5rem;background:white;border:2px solid #e7e5e4;border-radius:12px;cursor:pointer;font-size:1rem;font-weight:500;color:#292524;transition:all .2s;}
.school-btn:hover{background:#ecfdf5;border-color:#059669;}
.message{display:flex;gap:1rem;align-items:flex-start;}
.message.user{justify-content:flex-end;}
.avatar{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.avatar.ai{background:white;box-shadow:0 10px 25px rgba(0,0,0,.1);padding:4px;}
.avatar.ai img{width:100%;height:100%;object-fit:contain;}
.avatar.user{background:#e7e5e4;color:#57534e;font-size:.875rem;font-weight:500;}
.bubble{max-width:85%;padding:1rem 1.25rem;border-radius:16px;word-wrap:break-word;}
.bubble.user{background:#047857;color:white;border-radius:16px 16px 4px 16px;}
.bubble.ai{background:white;border:1px solid #e7e5e4;box-shadow:0 1px 2px rgba(0,0,0,.05);border-radius:16px 16px 16px 4px;line-height:1.6;}
.loading{display:flex;gap:.5rem;align-items:center;color:#78716c;font-size:.875rem;}
.input-area{position:sticky;bottom:0;background:linear-gradient(to top,#f5f5f4,#f5f5f4,transparent);padding:1.5rem 1rem;}
.input-container{max-width:56rem;margin:0 auto;}
.school-info{text-align:center;font-size:.75rem;color:#78716c;margin-bottom:.5rem;}
.input-box{display:flex;gap:.75rem;align-items:flex-end;padding:1rem;background:white;border:1px solid #e7e5e4;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.1);}
textarea{flex:1;border:none;outline:none;font-family:inherit;font-size:.9375rem;color:#292524;resize:none;min-height:44px;max-height:200px;overflow-y:auto;}
textarea::placeholder{color:#a8a29e;}
.send-btn{width:44px;height:44px;border-radius:12px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.send-btn:disabled{background:#e7e5e4;color:#a8a29e;cursor:not-allowed;}
.send-btn:not(:disabled){background:#059669;color:white;box-shadow:0 10px 25px rgba(5,150,105,.2);}
.send-btn:not(:disabled):hover{background:#047857;}
@media(max-width:640px){.logo{width:32px;height:32px;}.avatar{width:32px;height:32px;}.bubble{padding:.75rem 1rem;font-size:.875rem;}.school-selector img{width:96px;height:96px;}.school-selector h2{font-size:1.25rem;}.school-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<header class="header">
<div class="header-content">
<div class="header-left">
<img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6970b76c579f0b3ac47f48b8/ae70ac83f_imageislamiqueia.png" alt="IA Islam" class="logo">
<div class="header-text"><h1>IA ISLAM</h1><p>Islam Sunnite</p></div>
</div>
<button class="new-btn" onclick="resetConversation()">ðŸ”„ Nouveau</button>
</div>
</header>

<div class="container">
<div class="messages" id="messages">
<div class="school-selector" id="schoolSelector">
<img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6970b76c579f0b3ac47f48b8/ae70ac83f_imageislamiqueia.png" alt="IA Islam">
<h2>As-salamu alaykum</h2>
<p>Choisissez votre Ã©cole juridique pour des rÃ©ponses adaptÃ©es</p>
<div class="school-grid">
<button class="school-btn" onclick="selectSchool('Malikite')">ðŸ•Œ Malikite</button>
<button class="school-btn" onclick="selectSchool('Hanafite')">ðŸ•Œ Hanafite</button>
<button class="school-btn" onclick="selectSchool('Shafi\'ite')">ðŸ•Œ Shafi'ite</button>
<button class="school-btn" onclick="selectSchool('Hanbalite')">ðŸ•Œ Hanbalite</button>
<button class="school-btn" onclick="selectSchool('Toutes les Ã©coles')" style="grid-column:1/-1;">ðŸ“š Toutes les Ã©coles</button>
</div>
</div>
</div>
</div>

<div class="input-area" id="inputArea" style="display:none;">
<div class="input-container">
<div class="school-info" id="schoolInfo"></div>
<form class="input-box" id="chatForm">
<textarea id="userInput" placeholder="Posez votre question sur l'islam..." rows="1"></textarea>
<button type="submit" class="send-btn" id="sendBtn">Envoyer</button>
</form>
</div>
</div>

<script>
// URL de la Netlify Function
const FUNCTION_URL = 'https://iasabr-islamic.netlify.app/.netlify/functions/chat';

let selectedSchool = null;
let isLoading = false;

const messagesContainer = document.getElementById('messages');
const schoolSelector = document.getElementById('schoolSelector');
const inputArea = document.getElementById('inputArea');
const schoolInfo = document.getElementById('schoolInfo');
const chatForm = document.getElementById('chatForm');
const userInput = document.getElementById('userInput');

// Auto-resize textarea
userInput.addEventListener('input', function() {
  this.style.height='auto';
  this.style.height=Math.min(this.scrollHeight,200)+'px';
});

// Enter key submit
userInput.addEventListener('keydown', function(e){
  if(e.key==='Enter' && !e.shiftKey){
    e.preventDefault();
    chatForm.dispatchEvent(new Event('submit'));
  }
});

// --- Fonctions ---
async function selectSchool(school){
    selectedSchool = school;
    schoolSelector.style.display='none';
    inputArea.style.display='block';
    schoolInfo.textContent = `Ã‰cole sÃ©lectionnÃ©e : ${school}`;
    await sendMessage(`[Ã‰cole sÃ©lectionnÃ©e: ${school}] Utilisateur commence une conversation.`);
}

async function sendMessage(content){
  if(!selectedSchool) return;
  try{
    isLoading = true;
    addMessage(content,true);
    const res = await fetch(FUNCTION_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({content})
    });
    const data = await res.json();
    addMessage(data.response,false);
  } catch(err){
    console.error(err);
    addMessage('Erreur lors de l\'envoi du message', false);
  } finally{
    isLoading = false;
    userInput.value='';
    userInput.style.height='auto';
  }
}

function addMessage(content,isUser=false){
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message' + (isUser ? ' user' : '');
  if(isUser){
    messageDiv.innerHTML = `<div class="bubble user">${content}</div><div class="avatar user">Vous</div>`;
  } else {
    messageDiv.innerHTML = `<div class="avatar ai"><img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6970b76c579f0b3ac47f48b8/ae70ac83f_imageislamiqueia.png" alt="IA"></div><div class="bubble ai">${content}</div>`;
  }
  messagesContainer.appendChild(messageDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function resetConversation(){
  messagesContainer.innerHTML = `
    <div class="school-selector" id="schoolSelector">
        <img src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6970b76c579f0b3ac47f48b8/ae70ac83f_imageislamiqueia.png" alt="IA Islam">
        <h2>As-salamu alaykum</h2>
        <p>Choisissez votre Ã©cole juridique pour des rÃ©ponses adaptÃ©es</p>
        <div class="school-grid">
            <button class="school-btn" onclick="selectSchool('Malikite')">ðŸ•Œ Malikite</button>
            <button class="school-btn" onclick="selectSchool('Hanafite')">ðŸ•Œ Hanafite</button>
            <button class="school-btn" onclick="selectSchool('Shafi\'ite')">ðŸ•Œ Shafi'ite</button>
            <button class="school-btn" onclick="selectSchool('Hanbalite')">ðŸ•Œ Hanbalite</button>
            <button class="school-btn" onclick="selectSchool('Toutes les Ã©coles')" style="grid-column:1/-1;">ðŸ“š Toutes les Ã©coles</button>
        </div>
    </div>`;
  inputArea.style.display='none';
  selectedSchool = null;
  isLoading = false;
}

chatForm.addEventListener('submit', function(e){
  e.preventDefault();
  const question = userInput.value.trim();
  if(!question || isLoading) return;
  sendMessage(question);
});
</script>
</body>
</html>
